## 基础知识

CPU要和外部器件进行3类信息交互：

1. 存储单元的地址（`地址信息`）
2. 器件的选择，读或写的命令（`控制信息`）
3. 读或写的数据（`数据信息`）

计算机中专门连接CPU和其他器件的导线成为`总线`，总线根据传输的信息不同，逻辑上分为3类，`地址总线`、`控制总线`和`数据总线`

CPU 从 3 号单元中读取数据的过程：

![CPU从内存读取数据的过程](http://qiniu.liupzmin.com/cpu-read-data-from-memory.png)

1. CPU通过地址线将地址信息3发出

2. CPU通过控制线发出内存读命令，选中存储器芯片。

3. 存储芯片将3号单元重的数据8通过数据线送入CPU

写操作类似。如向 3 号单元写入数据 26

1. CPU通过地址线将地址信息 3 发出

2. CPU通过控制线发出内存写命令，选中存储器芯片。并通知它要向其中写入数据。

3. CPU通过数据总线将数据 26 送入内存 3 号单元

通过指令命令CPU进行读写

比如 8086CPU 从 3 号内存单元读取数据的指令机器码为：

`101000010000001100000000`

太难记了，所以用汇编指令表示：

`mov AX, [3]`

地址总线：影响计算机寻址，如果一个CPU地址总线宽度为N,这样的CPU最多可以寻找2的N次方的内存单元
数据总线：影响数据的传输速度，如果数据总线宽度为8，那么我们传输一个16进制数据（89D8）则需要两次。如下图：

![](http://qiniu.liupzmin.com/data-bus.png)

控制总线：控制总线的宽度决定了CPU对系统中其他器件的控制能力。

关于物理地址空间：

![](http://qiniu.liupzmin.com/physical-address-space.png)

**系统中所有存储器中的存储单元都处于一个统一的逻辑存储器中，它的容量受CPU寻址能力的限制。如果说寻址为4G，那么4G的内存条是无法全部用上的**

有篇博客论述了此事：[显存占用地址空间的问题](https://blog.csdn.net/vigour_lu/article/details/1966672)

## 8086CPU如何给出物理地址

见汇编语言第二章 21 页图：

1. CPU 中的相关部件提供两个16位地址（CS +  IP），一个是段地址如： CS ，一个是偏移地址 IP 。
2. 两个地址通过内部总线送入一个叫地址加法器的部件。
3. 地址加法器将两个地址合成为一个 20 位的物理地址
4. 地址加法器通过内部总线将 20 位物理地址送入输入输出控制电路。
5. 输入输出控制电路将 20 位物理地址送上地址总线。
6. 20 位物理地址被地址总线传送到存储器。


**地址加法器是讲段地址左移4位，再加上偏移地址 `段地址*16+偏移地址=物理地址 `**，虽然名为段地址，但内存并不分段，只是 CPU 的处理方式，本质上是用两个低位的寄存器合成一个高位地址，可以有任意的组合来定位一段连续的内存，段的起始地址因为左移 4 位，所以是 16 的倍数，IP 是16位的，最大寻址为 64K ，所以一个段最大为 64K

现代cpu并没有摆脱掉段寄存器的设计，但是使用方式略有变化，可以参考：
- [一个古老又广泛的寻址技术：段寄存器](https://zhuanlan.zhihu.com/p/69504370)
- [段寄存器的故事](https://www.cnblogs.com/johnnyflute/p/3564894.html)